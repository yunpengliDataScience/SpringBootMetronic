<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	
	<!-- Select the block having id as 'formDetail' here in this page and pass it as a parameter to the fragement named 'pageTemplate'
		 defined in pageTemplate.html under fragments folder. The content should show up as the main content. 
		 Since all styles, navigation, and page layout have been defined in the pageTemplate fragment, we only need to 
		 focus on the main content construction. In addtion, page specific css links and scripts can be added. 
	-->
	<th:block th:replace="fragments/pageTemplate :: pageTemplate(title='Form Detail', pageId='formDetail', pageSpecificCSSLinks=~{}, pageSpecificScripts=~{::script}, content=~{:: #formDetail})">
		
		<th:block id="formDetail">
			
			<!--begion::row-->
			<div class="row">

				<!--begin::column-->
				<div class="col-md-12">
					
					<!--begin::portlet-->
					<div class="kt-portlet">
						
						<div class="kt-portlet__head">
							<div class="kt-portlet__head-label">
								<h3 class="kt-portlet__head-title">
									Form Detail
								</h3>
							</div>
						</div>

						<!--begin::form-->
						<form class="kt-form" action="#" th:action="@{/forms/save}" th:object="${form}" method="post">
							<input type="hidden" th:field="*{id}">
							<div class="kt-portlet__body">
								<div class="form-group form-group-last">
									<div class="alert alert-secondary" role="alert">
										<div class="alert-icon"><i class="flaticon-warning kt-font-brand"></i></div>
										<div class="alert-text">
											Demonstrate a basic form.
										</div>
									</div>
								</div>
								<div class="form-group">
									<label for="name" class="col-form-label">Form Name</label>
                    				<input type="text" th:field="*{name}" class="form-control" id="name" placeholder="Form Name" 
                    					th:required="required">
                    				<span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="codes" class="col-form-label">Code Selection</label>
								    <select id="codes" name="codeOptions" class="form-control" th:field="*{code}">
								        <option value="" disabled selected>Select a code</option> <!-- Default option -->
								        <option th:each="code : *{codes}" th:value="${code}" th:text="${code}" ></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="dynamicDropdown" class="col-form-label">Dynamic Dropdown</label>
									
									<select id="dynamicDropdown" class="form-control">
									  <option value="" disabled selected></option> <!-- Default option -->
									  <option value="1" data-brief="Option 1" data-detailed="Option 1 - Detailed Description">
									    Option 1
									  </option>
									  <option value="2" data-brief="Option 2" data-detailed="Option 2 - Detailed Description">
									    Option 2
									  </option>
									  <option value="3" data-brief="Option 3" data-detailed="Option 3 - Detailed Description">
									    Option 3
									  </option>
									</select>
								    
								</div>
								
								<div class="form-group">
									<label for="words" class="col-form-label">Word Selection</label>
								    <select id="words" name="wordOptions" class="form-control" th:field="*{word}">
								        <option value="" disabled selected>Select a word</option> <!-- Default option -->
								        <option th:each="word : ${words}" th:value="${word}" th:text="${word}" ></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="category" class="col-form-label">Category</label>
								    <select id="category" name="codeOptions" class="form-control" th:field="*{category}">
								        <option value="" selected>Select a Category</option> <!-- Default option -->
								        <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="subCategory" class="col-form-label">Subcategory</label>
								    <select id="subCategory" name="codeOptions" class="form-control" th:field="*{subCategory}">
								        <option value="" selected>Select a Subcategory</option> <!-- Default option -->
								        <option th:each="subCategory : ${subCategories}" th:value="${subCategory.id}" th:text="${subCategory.name}"></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="field1" class="col-form-label">Text Field 1</label>
                    				<input type="text" th:field="*{field1}" class="form-control" id="field1" placeholder="Field1">
                    				<span th:if="${#fields.hasErrors('field1')}" th:errors="*{field1}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="field2" class="col-form-label">Text Field 2</label>
                    				<input type="text" th:field="*{field2}" class="form-control" id="field2" placeholder="Field2">
                    				<span th:if="${#fields.hasErrors('field2')}" th:errors="*{field2}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="items">Multiple Select Items</label>
									<select multiple="multiple" th:field="*{items}" class="form-control" id="items">
										<option th:each="item : ${itemList}" th:value="${item.id}" th:text="${item.name}"></option>
									</select>
								</div>
								<div class="form-group form-group-last">
									<label for="exampleTextarea">Textarea</label>
									<textarea class="form-control" th:field="*{textArea}" id="textarea" rows="3"></textarea>
								</div>
							</div>
							<div class="kt-portlet__foot">
								<div class="kt-form__actions">
									<input type="submit" class="btn btn-primary" value="Save Form"/>
									<input type="reset" class="btn btn-secondary" value="Cancel">
								</div>
							</div>
						</form>
						<!--end::form-->
					</div>
					<!--end::portlet-->
				</div>
				<!--end::column-->
				
			</div>
			<!--end::row-->
		</th:block>
		
		<script>
			$(document).ready(function() {
				console.log('Script is added.');
				//Use Select2
				$('#words').select2();
				
				});
				
			 $(document).ready(function() {
	            $('#category').change(function() {
					
					var requestPath = "[[@{'/api'}]]" + "/subcategories/";
					
	                var categoryId = $(this).val();
	                var subcategorySelect = $('#subCategory');
	                subcategorySelect.empty().append('<option value="">Select a Subcategory</option>');
	
					//alert(categoryId);
					//alert(requestPath);
					
	                if (categoryId) {
						var url = requestPath + categoryId;
						
						//alert(url);
						
	                    $.ajax({
	                        //url: 'http://localhost:8082/SpringBootMetronic/api/subcategories/' + categoryId,
	                        url: url,
	                        method: 'GET',
	                        success: function(data) {
	                            data.forEach(function(subcategory) {
	                                subcategorySelect.append('<option value="' + subcategory.id + '">' + subcategory.name + '</option>');
	                            });
	                        }
	                    });
	                }
	            });
	        });
	        
	        /**
	        	1. **`focus click` Event:**
   				- When the dropdown is focused or clicked, all options are immediately updated to their detailed text (`data-detailed`). This ensures that even the selected option will display its detailed description.
				2. **`change` Event:**
   				- When an option is selected, the script updates the text of the selected option to its brief message (`data-brief`) after a slight delay. This allows the dropdown to close before changing the text.
				3. **`blur` Event:**
   				- When the dropdown loses focus, the script resets the `optionSelected` flag and updates the selected option to display its brief text, while all other options revert to their detailed text.
	        **/
	        $(document).ready(function () {
	            var $dropdown = $('#dynamicDropdown');
	            
	            // Event to show detailed messages when dropdown is focused
	            $dropdown.on('focus click', function () {
	                // Update to detailed text for all options when dropdown is focused or clicked
	                $dropdown.find('option').each(function () {
	                    var detailedText = $(this).data('detailed'); // Get the detailed text
	                    $(this).text(detailedText); // Update the option text to detailed
	                });
	            });
	
	            // Event to show brief message when an option is selected
	            $dropdown.on('change', function () {
	                
	                // Get the selected option
	                var $selectedOption = $dropdown.find('option:selected');
	                var briefText = $selectedOption.data('brief'); // Get the brief text
	
	                // Use a timeout to allow dropdown to close before setting brief text
	                setTimeout(function () {
	                    $selectedOption.text(briefText); // Update the selected option text to brief
	
	                    // Reset other options to detailed text
	                    $dropdown.find('option').not($selectedOption).each(function () {
	                        var detailedText = $(this).data('detailed'); // Get the detailed text for other options
	                        $(this).text(detailedText); // Reset text to detailed for other options
	                    });
	                }, 10);
	            });
	
	            // Event to handle when dropdown loses focus
	            $dropdown.on('blur', function () {
	            
	                var $selectedOption = $dropdown.find('option:selected');
	                var briefText = $selectedOption.data('brief'); // Get the brief text
	
	                // Set brief text for the selected option
	                $selectedOption.text(briefText);
	
	                // Reset other options to detailed text
	                $dropdown.find('option').not($selectedOption).each(function () {
	                    var detailedText = $(this).data('detailed');
	                    $(this).text(detailedText);
	                });
	            });
	            
	        });
		</script>
		
	</th:block>
</html>