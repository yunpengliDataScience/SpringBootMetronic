<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	
	<!-- Select the block having id as 'formDetail' here in this page and pass it as a parameter to the fragement named 'pageTemplate'
		 defined in pageTemplate.html under fragments folder. The content should show up as the main content. 
		 Since all styles, navigation, and page layout have been defined in the pageTemplate fragment, we only need to 
		 focus on the main content construction. In addtion, page specific css links and scripts can be added. 
	-->
	<th:block th:replace="fragments/pageTemplate :: pageTemplate(title='Form Detail', pageId='formDetail', pageSpecificCSSLinks=~{}, pageSpecificScripts=~{::script}, content=~{:: #formDetail})">
		
		<th:block id="formDetail">
			
			<!--begion::row-->
			<div class="row">

				<!--begin::column-->
				<div class="col-md-12">
					
					<!--begin::portlet-->
					<div class="kt-portlet">
						
						<div class="kt-portlet__head">
							<div class="kt-portlet__head-label">
								<h3 class="kt-portlet__head-title">
									Form Detail
								</h3>
							</div>
						</div>

						<!--begin::form-->
						<form class="kt-form" action="#" th:action="@{/forms/save}" th:object="${form}" method="post">
							<input type="hidden" th:field="*{id}">
							<div class="kt-portlet__body">
								<div class="form-group form-group-last">
									<div class="alert alert-secondary" role="alert">
										<div class="alert-icon"><i class="flaticon-warning kt-font-brand"></i></div>
										<div class="alert-text">
											Demonstrate a basic form.
										</div>
									</div>
								</div>
								<div class="form-group">
									<label for="name" class="col-form-label">Form Name</label>
                    				<input type="text" th:field="*{name}" class="form-control" id="name" placeholder="Form Name" 
                    					th:required="required">
                    				<span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="codes" class="col-form-label">Code Selection</label>
								    <select id="codes" name="codeOptions" class="form-control" th:field="*{code}">
								        <option value="" disabled selected>Select a code</option> <!-- Default option -->
								        <option th:each="code : *{codes}" th:value="${code}" th:text="${code}" ></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="category" class="col-form-label">Category</label>
								    <select id="category" name="codeOptions" class="form-control" th:field="*{category}">
								        <option value="" selected>Select a Category</option> <!-- Default option -->
								        <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="subCategory" class="col-form-label">Subcategory</label>
								    <select id="subCategory" name="codeOptions" class="form-control" th:field="*{subCategory}">
								        <option value="" selected>Select a Subcategory</option> <!-- Default option -->
								        <option th:each="subCategory : ${subCategories}" th:value="${subCategory.id}" th:text="${subCategory.name}"></option>
								    </select>
								</div>
								
								<div class="form-group">
									<label for="field1" class="col-form-label">Text Field 1</label>
                    				<input type="text" th:field="*{field1}" class="form-control" id="field1" placeholder="Field1">
                    				<span th:if="${#fields.hasErrors('field1')}" th:errors="*{field1}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="field2" class="col-form-label">Text Field 2</label>
                    				<input type="text" th:field="*{field2}" class="form-control" id="field2" placeholder="Field2">
                    				<span th:if="${#fields.hasErrors('field2')}" th:errors="*{field2}" class="text-danger"></span>
								</div>
								<div class="form-group">
									<label for="exampleSelect2">Multiple Select</label>
									<select multiple="multiple" class="form-control" id="exampleSelect2">
										<option th:each="item : *{items}" th:value="${item}" th:text="${item}"></option>
									</select>
								</div>
								<div class="form-group form-group-last">
									<label for="exampleTextarea">Textarea</label>
									<textarea class="form-control" th:field="*{textArea}" id="textarea" rows="3"></textarea>
								</div>
							</div>
							<div class="kt-portlet__foot">
								<div class="kt-form__actions">
									<input type="submit" class="btn btn-primary" value="Save Form">
									<button type="reset" class="btn btn-secondary">Cancel</button>
								</div>
							</div>
						</form>
						<!--end::form-->
					</div>
					<!--end::portlet-->
				</div>
				<!--end::column-->
				
			</div>
			<!--end::row-->
		</th:block>
		
		<script>
			$(document).ready(function() {
				console.log('Script is added.');
				});
				
			 $(document).ready(function() {
	            $('#category').change(function() {
					
					var requestPath = "[[@{'/api'}]]" + "/subcategories/";
					
	                var categoryId = $(this).val();
	                var subcategorySelect = $('#subCategory');
	                subcategorySelect.empty().append('<option value="">Select a Subcategory</option>');
	
					//alert(categoryId);
					//alert(requestPath);
					
	                if (categoryId) {
						var url = requestPath + categoryId;
						
						//alert(url);
						
	                    $.ajax({
	                        //url: 'http://localhost:8082/SpringBootMetronic/api/subcategories/' + categoryId,
	                        url: url,
	                        method: 'GET',
	                        success: function(data) {
	                            data.forEach(function(subcategory) {
	                                subcategorySelect.append('<option value="' + subcategory.id + '">' + subcategory.name + '</option>');
	                            });
	                        }
	                    });
	                }
	            });
	        });
		</script>
		
	</th:block>
</html>