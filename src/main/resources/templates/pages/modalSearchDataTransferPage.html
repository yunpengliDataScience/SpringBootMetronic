<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Select the block having id as 'mainContent' here in this page and pass it as a parameter to the fragement named 'pageTemplate'
		 defined in pageTemplate.html under fragments folder. The content should show up as the main content. 
		 Since all styles, navigation, and page layout have been defined in the pageTemplate fragment, we only need to 
		 focus on the main content construction. In addtion, page specific css links and scripts can be added. 
	-->
<th:block
	th:replace="fragments/pageTemplate :: pageTemplate(title='Modal Search Data Transfer Page', pageId='modalSearchDataTransferPage', pageSpecificCSSLinks=~{:: link}, pageSpecificScripts=~{::script}, content=~{:: #mainContent})">

	<link rel="stylesheet" type="text/css" th:href="@{/css/sampleStyle.css}" />

	<th:block id="mainContent">
		<div class="container">
			<div class="row text-center">
				<div class="col-12">
					<h1>Demonstration of Transferring Search Result Data from Modal to Main Form Fields</h1>
				</div>
			</div>
			
			<div class="row">
				<!-- Modal Trigger -->
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#searchModal">
					Search
				</button>
			</div>
			
			<!-- Modal -->
			<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel"
				aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="searchModalLabel">Search</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<!-- Search Input -->
							<input type="text" id="searchInput" class="form-control" placeholder="Enter search term">
							<button class="btn btn-primary mt-2" id="searchBtn">Search</button>

							<!-- Search Results Table -->
							<table class="table mt-3" id="searchResults">
								<thead>
									<tr>
										<th>Select</th>
										<th>Field 1</th>
										<th>Field 2</th>
										<th>Field 3</th>
									</tr>
								</thead>
								<tbody>
									<!-- Results will be appended here by jQuery -->
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- Main Page Form -->
			<div class="row">
				<div class="col-12">
					<form>
						<div class="form-group">
							<label for="field1" class="col-form-label">Field 1</label>
							<input type="text" id="field1" class="form-control">
						</div>
						<div class="form-group">
							<label for="field2" class="col-form-label">Field 2</label>
							<input type="text" id="field2" class="form-control">
						</div>
						<div class="form-group">
							<label for="field3" class="col-form-label">Field 3</label>
							<input type="text" id="field3" class="form-control">
						</div>
					</form>
				</div>
			</div>
		</div>
	</th:block>

	<script>
		$(document).ready(function () {
			
			url = "[[@{'/api/modalSearchDataTransfer'}]]";
			
			// Handle search button click
			$('#searchBtn').click(function () {
				var searchTerm = $('#searchInput').val();

				// Perform AJAX call to search (adjust URL as needed for your backend)
				$.ajax({
					url: url, // URL to Spring Boot controller
					method: 'GET',
					data: {query: searchTerm},
					success: function (data) {
						// Populate the table with results
						var rows = '';
						data.forEach(function (item) {
							rows += '<tr>' +
								'<td><input type="radio" name="selectRow" value="' + item.field1 + ',' + item.field2 + ',' + item.field3 + '"></td>' +
								'<td>' + item.field1 + '</td>' +
								'<td>' + item.field2 + '</td>' +
								'<td>' + item.field3 + '</td>' +
								'</tr>';
						});
						$('#searchResults tbody').html(rows);
					},
					error: function () {
						alert('Error retrieving search results');
					}
				});
			});

			// Handle row or radio button click
			$(document).on('click', 'input[name="selectRow"]', function () {
				var selectedData = $(this).val().split(',');

				// Transfer data to form fields on the main page
				$('#field1').val(selectedData[0]);
				$('#field2').val(selectedData[1]);
				$('#field3').val(selectedData[2]);

				// Close modal after selection
				//$('#searchModal').modal('hide');
			});
		});

	</script>
</th:block>

</html>